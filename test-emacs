#!/usr/bin/env zsh
set -e

EMACS="${EMACS:-emacs}"

case "$OSTYPE" in
darwin*)
    EMACS="/Applications/Emacs.app/Contents/MacOS/Emacs"
    ;;
esac

ELPA_DIR=.cask/$($EMACS -Q --batch --eval '(princ emacs-version)')/elpa

TEST_CONFIG=${HOME}/dot_files/emacs/test_emacs

if [ -e "Cask" -a -d "${ELPA_DIR}" ]; then
    cask exec $EMACS -Q -l $TEST_CONFIG $@
else
    $EMACS -Q -l $TEST_CONFIG $@
fi
